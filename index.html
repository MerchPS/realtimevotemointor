<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Motionime Vote Tracker - 8 Submissions</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  body{background:#0b1420;color:#eaf1ff;font-family:Inter,sans-serif;padding:20px;}
  h1{text-align:center;margin-bottom:10px;}
  table{width:100%;border-collapse:collapse;margin-top:10px;}
  th,td{padding:8px 10px;border-bottom:1px solid #243041;text-align:left;}
  th{background:#132033;}
  tr:nth-child(even){background:#101b2d;}
  .up{color:#33ff77;font-weight:bold;}
  .down{color:#ff6b6b;font-weight:bold;}
  .status{margin:10px 0;color:#8da1c0;font-size:14px;}
  footer{text-align:center;color:#697a96;margin-top:20px;font-size:12px;}
</style>
</head>
<body>
  <h1>ðŸ“Š MotionimeFest Vote Monitor</h1>
  <div class="status" id="status">Initializing...</div>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Nama</th>
        <th>Votes</th>
        <th>Î” Votes</th>
        <th>Views</th>
        <th>Last Update</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <footer>Auto refresh setiap 2.5 detik â€¢ Reload halaman jika berhenti update</footer>

<script>
const submissions = [
  {id:24087, name:"xxknjt"},
  {id:24084, name:"Boo"},
  {id:24081, name:"JustDani"},
  {id:24078, name:"SonMV"},
  {id:24075, name:"KekeLawar"},
  {id:24066, name:"searchforemma"},
  {id:24072, name:"YaraYay"},
  {id:24069, name:"Wasawho"}
];

const PARTICIPATE_URL = "https://motionimefest.id/contest/newcomer-streamer-of-the-year/participate/?cid=23816&cm=1";
const SUBMISSIONS_URL = "https://motionimefest.id/contest/newcomer-streamer-of-the-year/submissions/?cid=23816&cm=1&sd=desc&sb=date&cpn=1";
const SUB_BASE = "https://motionimefest.id/contest/newcomer-streamer-of-the-year/submission/";

const PROXIES = [
  u => `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`,
  u => `https://thingproxy.freeboard.io/fetch/${u}`
];

let lastVotes = {};
let firstRun = true;

const statusEl = document.getElementById("status");
const tbody = document.getElementById("tableBody");

function parseNum(txt){
  if(!txt)return 0;
  const n = txt.replace(/[^\d]/g,'');
  return parseInt(n)||0;
}

async function fetchWithProxy(url){
  try {
    const res = await fetch(url);
    if(res.ok)return await res.text();
  } catch{}
  for(const proxy of PROXIES){
    try{
      const res = await fetch(proxy(url));
      if(res.ok)return await res.text();
    }catch{}
  }
  throw new Error("All fetch failed: "+url);
}

async function refreshSequence(){
  try{
    statusEl.textContent = "Refreshing source cache...";
    await fetchWithProxy(PARTICIPATE_URL);
    await fetchWithProxy(SUBMISSIONS_URL);
    statusEl.textContent = "Fetching 8 submissions...";
    const results = [];

    for(const s of submissions){
      const html = await fetchWithProxy(`${SUB_BASE}${s.id}/?cid=23816&cm=1`);
      const votesMatch = html.match(/([\d,\.]+)\s*Votes/i);
      const viewsMatch = html.match(/([\d,\.]+)\s*Views/i);
      const votes = votesMatch ? parseNum(votesMatch[1]) : 0;
      const views = viewsMatch ? parseNum(viewsMatch[1]) : 0;

      let delta = 0;
      if(lastVotes[s.id]!=null) delta = votes - lastVotes[s.id];
      lastVotes[s.id] = votes;

      results.push({...s, votes, views, delta});
    }

    updateTable(results);
    firstRun = false;
    const t = new Date().toLocaleTimeString();
    statusEl.textContent = `Last updated ${t}`;
  }catch(e){
    statusEl.textContent = "Error: "+e.message;
  }
}

function updateTable(data){
  tbody.innerHTML = "";
  data.forEach(r=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${r.id}</td>
      <td>${r.name}</td>
      <td>${r.votes.toLocaleString()}</td>
      <td class="${r.delta>0?"up":r.delta<0?"down":""}">
        ${!firstRun?(r.delta>=0?`+${r.delta}`:r.delta):"-"}
      </td>
      <td>${r.views.toLocaleString()}</td>
      <td>${new Date().toLocaleTimeString()}</td>
    `;
    tbody.appendChild(tr);
  });
}

refreshSequence();
setInterval(refreshSequence, 2500);
</script>
</body>
</html>
