<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vote Comparator â€” All Submissions</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#07121b; --card:#0b1622; --muted:#98a6b8; --ycol:#6bc1ff; --wcol:#ff6b6b;
    --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
  body{margin:0;background:linear-gradient(180deg,#051022 0%, #071735 100%);color:#e6eef8;min-height:100vh;padding:22px;}
  .container{max-width:1100px;margin:0 auto;}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
  h1{margin:0;font-size:20px}
  p.lead{margin:4px 0 0;color:var(--muted);font-size:13px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);padding:12px;border-radius:10px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}
  .big{font-size:28px;font-weight:700}
  .small{color:var(--muted);font-size:12px}
  .delta-up{color:#6ee7b7;font-weight:700}
  .delta-down{color:#ff8b8b;font-weight:700}
  .chart-wrap{background:var(--card);padding:12px;border-radius:10px;margin-bottom:12px}
  canvas{max-width:100%}
  .summary{display:flex;gap:12px;flex-wrap:wrap}
  .stat{background:var(--glass);padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);min-width:160px}
  .muted{color:var(--muted)}
  footer{margin-top:14px;color:var(--muted);font-size:13px}
  .log{height:120px;overflow:auto;background:rgba(0,0,0,0.2);padding:8px;border-radius:8px;font-size:12px;color:#d9e9ff}
  
  .submissions-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-bottom: 12px;
  }
  .submission-card {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border: 1px solid rgba(255,255,255,0.04);
    padding: 12px;
    border-radius: 10px;
    box-shadow: 0 8px 30px rgba(2,6,23,0.6);
  }
  .submission-card h3 {
    margin: 0 0 6px;
    font-size: 14px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .submission-stats {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .submission-votes {
    font-size: 20px;
    font-weight: 700;
  }
  .submission-delta {
    text-align: right;
  }
  
  .controls {
    display: flex;
    gap: 8px;
    margin-bottom: 12px;
  }
  .btn {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    color: #e6eef8;
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 12px;
    cursor: pointer;
  }
  
  @media (max-width: 860px) { 
    .submissions-grid { grid-template-columns: repeat(2, 1fr); }
  }
  @media (max-width: 480px) { 
    .submissions-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Vote Comparator â€” All Submissions</h1>
        <p class="lead">Realtime tracking for all 8 submissions. Auto-update every <strong>3s</strong>.</p>
      </div>
      <div style="text-align:right">
        <div style="font-size:12px;color:var(--muted)">Status:</div>
        <div id="status" class="small muted">Initializingâ€¦</div>
      </div>
    </header>

    <div class="controls">
      <button id="refreshBtn" class="btn">ðŸ”„ Refresh Now</button>
    </div>

    <div class="submissions-grid" id="submissionsGrid">
      <!-- Will be populated by JavaScript -->
    </div>

    <div class="chart-wrap card">
      <canvas id="votesChart" height="140"></canvas>
    </div>

    <div class="card summary">
      <div class="stat">
        <div class="small muted">Current Leader</div>
        <div id="leadText" style="font-weight:700;font-size:16px">â€”</div>
      </div>
      <div class="stat">
        <div class="small muted">Total Î” (this session)</div>
        <div id="sessionDelta" style="font-weight:700;font-size:16px">Loading...</div>
      </div>
      <div class="stat">
        <div class="small muted">Last update</div>
        <div id="lastUpdate" style="font-weight:700;font-size:14px">â€”</div>
      </div>
    </div>

    <div style="margin-top:12px" class="card">
      <div class="small muted">Console log</div>
      <div id="console" class="log"></div>
    </div>

    <footer>
      <div class="small muted">Using mock data for demonstration. For real data, host on same domain.</div>
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
  (function(){
    // CONFIG
    const INTERVAL_MS = 3000;
    
    // All 8 submissions
    const SUBMISSIONS = [
      { id: "24087", name: "xxknjt" },
      { id: "24084", name: "ini boo" },
      { id: "24081", name: "JustDani" },
      { id: "24078", name: "SonMV" },
      { id: "24075", name: "KekeLawar" },
      { id: "24072", name: "Yaraayay" },
      { id: "24069", name: "Wasawho" },
      { id: "24066", name: "searchforemma" }
    ];

    // DOM
    const statusEl = document.getElementById('status');
    const logEl = document.getElementById('console');
    const submissionsGridEl = document.getElementById('submissionsGrid');
    const leadTextEl = document.getElementById('leadText');
    const sessionDeltaEl = document.getElementById('sessionDelta');
    const lastUpdateEl = document.getElementById('lastUpdate');
    const refreshBtn = document.getElementById('refreshBtn');

    // state
    let lastVotes = {};
    let lastTime = null;
    let sessionDelta = {};
    let historyLabels = [];
    let historyData = {};

    // Initialize state
    SUBMISSIONS.forEach(sub => {
      lastVotes[sub.id] = null;
      sessionDelta[sub.id] = 0;
      historyData[sub.id] = [];
    });

    // Base votes for mock data
    const baseVotes = {
      '24087': 1250, '24084': 1100, '24081': 980, '24078': 1350,
      '24075': 890, '24072': 1500, '24069': 1420, '24066': 760
    };

    // helper: log
    function clog(msg){
      const ts = new Date().toLocaleTimeString();
      logEl.innerText = `[${ts}] ${msg}\n` + logEl.innerText;
      if(logEl.innerText.split('\n').length > 20) {
        logEl.innerText = logEl.innerText.split('\n').slice(0, 15).join('\n');
      }
    }

    // Get mock data with realistic changes
    function getMockData(subId) {
      // Start with base votes
      let votes = baseVotes[subId];
      
      // If we have previous data, continue from there
      if (lastVotes[subId] !== null) {
        votes = lastVotes[subId];
      }
      
      // Random vote increase (0-3 votes per update)
      const increase = Math.floor(Math.random() * 4);
      votes += increase;
      
      // Calculate views (roughly 3-5x votes)
      const views = votes * (3 + Math.random() * 2);
      
      return {
        votes: votes,
        views: Math.floor(views)
      };
    }

    // Create submission cards
    function createSubmissionCards() {
      submissionsGridEl.innerHTML = '';
      SUBMISSIONS.forEach(sub => {
        const card = document.createElement('div');
        card.className = 'submission-card';
        card.id = `card-${sub.id}`;
        card.innerHTML = `
          <h3>${sub.name} â€” ${sub.id}</h3>
          <div class="submission-stats">
            <div>
              <div id="votes-${sub.id}" class="submission-votes">â€”</div>
              <div id="views-${sub.id}" class="small muted">â€” views</div>
            </div>
            <div class="submission-delta">
              <div class="small muted">Î” per 3s</div>
              <div id="delta-${sub.id}" class="small">â€”</div>
              <div class="small muted" style="margin-top:6px">Rate (v/s)</div>
              <div id="rate-${sub.id}" class="small">â€”</div>
            </div>
          </div>
        `;
        submissionsGridEl.appendChild(card);
      });
    }

    // UI update function
    function updateUI(data){
      // Update individual submission cards
      SUBMISSIONS.forEach(sub => {
        const votesEl = document.getElementById(`votes-${sub.id}`);
        const viewsEl = document.getElementById(`views-${sub.id}`);
        const deltaEl = document.getElementById(`delta-${sub.id}`);
        const rateEl = document.getElementById(`rate-${sub.id}`);
        
        const subData = data[sub.id];
        if (subData) {
          votesEl.innerText = subData.votes.toLocaleString();
          viewsEl.innerText = subData.views.toLocaleString() + ' views';
          
          // Calculate delta
          let delta = 0;
          if(lastVotes[sub.id] !== null) {
            delta = subData.votes - lastVotes[sub.id];
          }
          deltaEl.innerText = (delta >= 0 ? '+' + delta : delta);
          deltaEl.className = delta > 0 ? 'small delta-up' : (delta < 0 ? 'small delta-down' : 'small');
          
          // Calculate rate
          let rate = 0;
          if(lastTime !== null && delta > 0) {
            const elapsedSec = (Date.now() - lastTime) / 1000;
            rate = delta / elapsedSec;
          }
          rateEl.innerText = rate > 0 ? rate.toFixed(4) : '0.0000';
        }
      });

      // Update session delta
      let sessionText = "";
      SUBMISSIONS.forEach(sub => {
        if (sessionDelta[sub.id] !== 0) {
          if (sessionText) sessionText += " | ";
          sessionText += `${sub.name}: ${sessionDelta[sub.id] > 0 ? '+' : ''}${sessionDelta[sub.id]}`;
        }
      });
      sessionDeltaEl.innerText = sessionText || "No changes yet";

      // Update leader
      const validData = SUBMISSIONS.filter(sub => data[sub.id]);
      
      if (validData.length > 0) {
        const leader = validData.reduce((prev, curr) => 
          data[prev.id].votes > data[curr.id].votes ? prev : curr
        );
        const leaderVotes = data[leader.id].votes;
        
        leadTextEl.innerHTML = `${leader.name} leading with <strong>${leaderVotes.toLocaleString()}</strong> votes`;
      }

      lastUpdateEl.innerText = new Date().toLocaleTimeString();
    }

    // Chart.js setup
    const ctx = document.getElementById('votesChart').getContext('2d');
    
    const colors = [
      '#6bc1ff', '#ff6b6b', '#6ee7b7', '#f59e0b', '#a78bfa', 
      '#f97316', '#10b981', '#8b5cf6'
    ];
    
    const chartDatasets = SUBMISSIONS.map((sub, index) => ({
      label: `${sub.name}`,
      data: historyData[sub.id],
      borderColor: colors[index % colors.length],
      backgroundColor: colors[index % colors.length] + '20',
      tension: 0.2,
      pointRadius: 2,
      borderWidth: 2
    }));
    
    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: historyLabels,
        datasets: chartDatasets
      },
      options: {
        animation: false,
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: { 
            display: true,
            ticks: { maxTicksLimit: 8 }
          },
          y: { 
            display: true,
            beginAtZero: false,
            title: { display: true, text: 'Votes' } 
          }
        },
        plugins: { 
          legend: { 
            display: true,
            labels: {
              boxWidth: 12,
              font: { size: 11 }
            }
          } 
        }
      }
    });

    // main polling function
    function pollOnce(){
      const startTime = performance.now();
      
      try {
        const data = {};
        const now = Date.now();
        
        // Get data for all submissions
        SUBMISSIONS.forEach(sub => {
          const mockData = getMockData(sub.id);
          data[sub.id] = mockData;
          
          // Compute deltas
          let delta = 0;
          if(lastTime !== null && lastVotes[sub.id] !== null){
            delta = mockData.votes - lastVotes[sub.id];
          }
          
          // Update session totals
          if(delta > 0) {
            sessionDelta[sub.id] += delta;
          }
          
          // Update last votes
          lastVotes[sub.id] = mockData.votes;
        });
        
        // Push history
        const label = new Date().toLocaleTimeString();
        historyLabels.push(label);
        
        SUBMISSIONS.forEach(sub => {
          historyData[sub.id].push(data[sub.id].votes);
        });
        
        // Keep history limited
        if(historyLabels.length > 30){ 
          historyLabels.shift(); 
          SUBMISSIONS.forEach(sub => {
            historyData[sub.id].shift();
          });
        }

        // Update chart
        chart.data.labels = historyLabels;
        SUBMISSIONS.forEach((sub, index) => {
          chart.data.datasets[index].data = historyData[sub.id];
        });
        chart.update('none');

        // Update UI
        updateUI(data);

        // Update last time
        lastTime = now;

        const elapsedMs = Math.round(performance.now() - startTime);
        statusEl.innerText = `OK - ${elapsedMs}ms`;
        
        clog(`Update completed - ${elapsedMs}ms`);
        
      } catch(err) {
        statusEl.innerText = 'Error: ' + err.message;
        clog('Error: ' + err.message);
      }
    }

    // Event listeners
    refreshBtn.addEventListener('click', () => {
      clog("Manual refresh");
      pollOnce();
    });

    // Initialize application
    function initializeApp() {
      createSubmissionCards();
      clog("Vote Comparator started with mock data");
      
      // First poll
      pollOnce();
      
      // Start auto-update
      setInterval(pollOnce, INTERVAL_MS);
    }

    // Start the application
    initializeApp();

  })();
  </script>
</body>
</html>
